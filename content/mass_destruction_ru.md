+++
tags = ["ru"]
title = "Mass Destruction"
categories = ["ru"]
+++

# О проекте

Игра для Windows на FreePascal с использованием графического 2Д-движка ZenGL. Разрабатывается мною ради развлечения. Шутер с видом сверху-вниз.

# Журнал

## 2015.04.01 

Начал писать игру.


## 2015.06.01 

Реализовал чтобы враги атаковали и разрушали двери и стены если это кратчайший путь к игроку, например, когда игрок зашёл в помещение и закрыл дверь.


## 2015.06.12 

* Скриншот игры по состоянию в тот день: {{< link_to_file "mass_destruction_screenshot_2015.06.12.png" >}}


## 2015.07.01

* Добавил зомби в игру. Надо будет сделать им руки. #todo
* Исправил потенциальный баг у фичи TileView, который мог проявиться когда спрайт разрушается в то время когда просматриваешь его информацию.

## 2015.07.05

* Составил требования для MassDestruction v1.0

## 2015.07.06

* Реализовал анимацию лап для зомби.

## 2015.07.12

* Зомби теперь имеют анимации для попадания и гибели. Сделал рефакторинг анимаций и звуков.
* Доделал звуки для имеющихся врагов. Теперь имеются четыре звука, атака и гибель для зомби, а так же атака и гибель для таракана.
* Скриншот {{< link_to_file "mass_destruction_screenshot_2015.07.12.png" >}}; запущено в Windows 10 preview

## 2015.07.17

* Начал делать врагов-роботов

## 2015.08.29

* Одно из требований для версии 1.0 выполнено: тип врагов - роботы. Роботы имеют текстуры и звуки, двигаются и стреляют ракетой. Ракета взрывается при попадании и наносит урон ближайшим объектам и игроку. Следующая фича из списка требований к версии 1.0, которую я планирую реализовать, это типы оружия - пулемёт.

## 2015.09.02

* Доделал что там оставалось доделать для роботов: анимация попадания и погибания.
* Тип оружия - пулемёт в общем-то готов.

## 2015.09.09

* Доделал большую часть механики для гранатомёта, он теперь работает. Несколько изменил требования к MassDestruction 1.0: тип оружия гранаты заменил на гранатомёт потому, что у роботов уже есть гранатомёт и можно повторно использовать код.
* Делал рефакторинг: убирал uses из implementation. Убрал несколько штук, но ещё не доделал.

## 2015.09.13

* Генератор врагов теперь более-менее работает.
* Ракеты, выпущенные роботами, теперь наносят больше урона игроку и меньше урона всем остальным объектам, инчае игрок может использовать роботов чтобы разносить всё вокруг их же ракетами.

## 2015.09.14

* Работаю над бомбой (в процессе; ещё не готово). Бомбу можно закладывать в специально обозначенном месте. Она закладывается как только игрок оказывается в той же клетке.
* Рефакторинг: убарл ещё несколько круговых зависимостей между модулями (но ещё остались). Для этого разделил SpriteU на SpriteU и ObjectSpriteU.

## 2015.09.15

* Анимация взрыва бомбы готова. Смотрится стрёмно.
* Звук взрыва бомбы готов: это замедленный звук взрыва ракеты.
* Достижение получено: 5000 строк кода в проекте.
* Теперь требуется сделать, чтобы бомба наносила повреждения и пикала перед взрывом. 

## 2015.09.16

* Бомба наносит повреждения. Потестировал немного, вроде бы работает нормально.
* Поменял значения повреждений для ракет.

## 2015.09.23

* Бомба пикает перед взрывом.
* Убрал implementation-ссылки из DoorSpriteU.

## 2015.09.24

* Двери теперь открываются когда игрок близко и закрываются когда игрок отходит. Теперь не нужно нацеливаться на дверь и нажимать кнопку E. Так удобнее.

Планирую дальше сделать ящички со здоровьем. Кроме того, нужно сделать, чтобы двери открывались когда к ним подходишь.

# Мои достижения

* 2015.04.10: **3000 строк кода**
* 2015.07.01: **100 часов работы**
* 2015.08.22: **4000 строк кода**
* 2015.09.15: **5000 строк кода**

Для измерения количества строк кода используется утилита [cloc](http://cloc.sourceforge.net/).


# Требования

## MassDestruction v1.0

Требования к первой версии игры

* 2D
* Windows
* Управление клавиатура + мышь
* Сохранение

Сохранение происходит в конце прохождения миссии. Сохраняется только сам факт прохождения миссии: пройдена или не пройдена. Вначале все миссии находятся в состоянии "не пройдены". 

**Нет** сохранений в произвольное время посередине карты. 

Кроме того, сохраняется "счёт": сколько монстров каждого типа убито. Счёт показывается в конце прохождения каждой миссии: например, "миссия пройдена, тараканов уничтожено: 50, зомби уничтожено: 200, роботов уничтожено: 6, генераторов уничтожено: 1".

### Типы врагов

* Тараканы
* Зомби
* Роботы

_Зомби_ медленные и слабые, их можно будет размещать на карте в больших количествах.

_Роботы_ - что-то вроде боссов; убивают в рукопашную с двух-трёх ударов. Перед тем как робот выпускает ракету, он обязан как-то "просигнализировать" об этом визуально. Ракета летит только по прямой. Алгоритм "прицеливания" тупой: робот выпускает ракету не зависимо от того, есть ли на её пути препятствия. Ракета взрывается от столкновения с первым попавшимся ей на пути объектом.

_Тараканы_ слабые, но быстрые. От них придётся побегать.

Для каждого типа врага нужно два звука: звук, издаваемый при атаке и звук, издаваемый при гибели.

### Типы оружия

* Пистолет
* Пулемёт
* Гранатомёт
* Бомбы

_Пистолет_ - слабое оружие. У пистолета бесконечные патроны.

_Пулемёт_, основное оружие. Как пистолет, только стреляет очередями.

_Гранатомёт_ стреляет ракетой. Ракета взрывается при попадании в любой объект и наносит урон в радиусе действия.

_Бомбы_ не могут быть использованы произвольно, а только лишь на специальных объектах: на запертых дверях и на генераторах врагов.

### Объекты на карте

* Стены
* Двери
* Враги
* Генераторы врагов
* Ящики
* Декорации

_Стены_ делятся на разрушаемые-кирпичные и неразрушаемые-бетонные. Только два типа стен.

_Двери_ делятся на запертые и нормальные. Запертые можно только разрушить. Нормальные двери можно открывать и закрывать. Нормальными дверями можно запираться от монстров. Двери активируются (открываются либо закрываются) когда игрок в радиусе 2-х клеток от двери наводит мышь на дверь и нажимает E.

_Враги_ нападают на игрока когда видят его. 
Нужно реализовать такие механизмы активации врагов:

* Когда враг видит игрока
* Когда враг получает повреждение, то он нападет на игрока, даже если его не видит, иначе можно будет врагов расстреливать издалека.
* Если враги стоят в прилегающих клетках, то активация одного врага приводит к активации всех врагов
* "Заскриптованный" механизм активации: враг активируется при определённом условии если этого требует миссия

Враги могут долбиться в стены и двери, если это наиболее "дешёвый" путь, которым они могут добраться до игрока. Когда враги "активируются", то они пытаются убить игрока пока не погибнут.

_Генераторы врагов_ активируются кодом сценария миссии и продолжают "испускать" врагов пока не будут уничтожены бомбой.

_Ящики_ могут содержать полезные вещи. Активируются когда игрок в радиусе 2-х клеток от ящика наводит мышь на ящик и нажимает E. При "активации" содержимое ящика добавляется в инвентарь.

_Декорации_ это объекты, которые ничего не делают, и могут быть разрушены.

* Компьютерный стол
* Куст
* Сервер?
* Холодильник?
* Забор?
* Бочка?

Типы ящиков:

* Патроны
* Гранаты
* Здоровье

### Миссии

Для каждой мисии должна быть своя карта и свой "сценарий". Карта это файл, сценарий это класс, который свой для каждой миссии. 

Класс-сценарий должен делать определённые проверки и действия, как например:

* Если прошло 3 секунды с момента загрузки карты, то показать текст, описывающий, что нужно сделать в данной миссии.
* Если расстояние от игрока до клетки Х меньше 5, то активировать группу врагов А.
* Если генераторы монстров A, B, C уничтожены, то показать игроку текст, описывающий что делать дальше.
* Если расстояние от игрока до клетки E меньше 3, то миссия выполнена.

Проверки и действия достаточно простые, и реализовать их будет, наверное, не сложно. Текст миссии пропускается на определённую кнопку, например, пробел.

Нужно напридумывать несколько миссий, например, шесть.

### Дополнительные фичи

_Просмотр_: при нажатии правой кнопки мыши, показывается название объекта

_Тряска камеры_: при срабатывании бомбы камера трясётся. Нужно подобрать оптимальную длительность и интенсивность.